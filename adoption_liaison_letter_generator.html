<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VOKRA Adoption Follow-up Email Generator</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(
          135deg,
          #723cd7 0%,
          #5697cc 50%,
          #6e6ad6 100%
        );
        min-height: 100vh;
        padding: 20px;
        transition: background 0.3s ease, color 0.3s ease;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: #fff;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: background 0.3s ease, color 0.3s ease;
      }
      .header {
        position: relative;
        background: linear-gradient(135deg, #9870dc, #7c4dcd);
        color: #fff;
        padding: 30px;
        text-align: center;
      }
      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }
      .header p {
        font-size: 1.2em;
        opacity: 0.9;
      }
      .theme-toggle {
        position: absolute;
        right: 16px;
        top: 16px;
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(3px);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-radius: 999px;
        padding: 8px 12px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, opacity 0.2s ease;
      }
      .theme-toggle:hover {
        transform: translateY(-1px);
        opacity: 0.95;
      }

      .main-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0;
      }
      .form-section {
        padding: 40px;
        background: #f8f9fa;
        border-right: 1px solid #e9ecef;
        transition: background 0.3s ease, color 0.3s ease;
      }
      .output-section {
        padding: 40px;
        background: #fff;
        transition: background 0.3s ease, color 0.3s ease;
      }
      .form-group {
        margin-bottom: 25px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #495057;
        font-size: 0.95em;
        transition: color 0.3s ease;
      }
      .form-group input,
      .form-group select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 16px;
        transition: all 0.3s ease;
        background: #fff;
        color: #111827;
      }
      .form-group input::placeholder {
        color: #9aa3af;
      }
      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #4caf50;
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        transform: translateY(-1px);
      }
      .checkbox-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 10px;
      }
      .checkbox-item {
        display: flex;
        align-items: center;
        padding: 10px;
        background: #fff;
        border-radius: 8px;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
        cursor: pointer;
      }
      .checkbox-item:hover {
        border-color: #4caf50;
        transform: translateY(-1px);
      }
      .checkbox-item input[type="checkbox"] {
        width: auto;
        margin-right: 10px;
        transform: scale(1.2);
      }
      .checkbox-item input[type="checkbox"]:checked + span {
        color: #4caf50;
        font-weight: 600;
      }
      .toolbar {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }
      .generate-btn,
      .reset-btn {
        flex: 1 1 160px;
        min-width: 160px;
        padding: 14px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        letter-spacing: 0.3px;
      }
      .generate-btn {
        background: linear-gradient(135deg, #4caf50, #45a049);
        color: #fff;
        text-transform: uppercase;
      }
      .generate-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
      }
      .reset-btn {
        background: linear-gradient(135deg, #9aa5b1, #6b7280);
        color: #fff;
      }
      .reset-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(107, 114, 128, 0.35);
      }
      .output {
        background: transparent;
        border: 2px solid #e9ecef;
        border-radius: 8px;
        padding: 25px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        line-height: normal;
        min-height: 500px;
        color: #000;
        transition: background 0.3s ease, color 0.3s ease,
          border-color 0.3s ease;
      }
      .output p {
        margin: 0 0 16px 0;
      }
      .copy-btn {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #007bff, #0056b3);
        color: #fff;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 15px;
      }
      .copy-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 16px rgba(0, 123, 255, 0.3);
      }
      .copy-success {
        color: #28a745;
        text-align: center;
        margin-top: 10px;
        font-weight: 600;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      .copy-success.show {
        opacity: 1;
      }
      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
        }
        .form-section {
          border-right: none;
          border-bottom: 1px solid #e9ecef;
        }
        .checkbox-group {
          grid-template-columns: 1fr;
        }
        .header h1 {
          font-size: 2em;
        }
      }
      .section-title {
        font-size: 1.3em;
        color: #4caf50;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #e9ecef;
        font-weight: 700;
      }
      .add-cat-btn {
        background: linear-gradient(135deg, #17a2b8, #138496);
        color: #fff;
        border: none;
        border-radius: 8px;
        padding: 12px 20px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 20px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .add-cat-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 12px rgba(23, 162, 184, 0.3);
      }
      .cat-section {
        background: #fff;
        border: 2px solid #e9ecef;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
        position: relative;
        transition: background 0.3s ease, border-color 0.3s ease;
      }
      .cat-section h3 {
        color: #4caf50;
        margin-bottom: 15px;
        font-size: 1.1em;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .remove-cat-btn {
        background: #dc3545;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 6px 12px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      .remove-cat-btn:hover {
        background: #c82333;
        transform: translateY(-1px);
      }
      .same-as-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 10px;
        padding: 8px;
        background: #e3f2fd;
        border-radius: 6px;
        font-size: 0.9em;
      }
      .same-as-checkbox input[type="checkbox"] {
        width: auto;
        margin: 0;
      }
      .search-microchip-btn {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 8px 15px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
        min-width: 140px;
      }
      .search-microchip-btn:hover:not(:disabled) {
        background: linear-gradient(135deg, #218838, #1e7e34);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
      }
      .search-microchip-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
        opacity: 0.6;
      }
      .microchip-companies {
        display: none;
        margin-top: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e9ecef;
      }
      .microchip-companies.show {
        display: block;
      }
      .microchip-company-options {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .microchip-company-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        background: #fff;
        border-radius: 6px;
        border: 1px solid #e9ecef;
        transition: all 0.3s ease;
      }
      .microchip-company-item:hover {
        border-color: #4caf50;
      }
      .microchip-company-item input[type="checkbox"],
      .microchip-company-item input[type="radio"] {
        width: auto;
        margin: 0;
        transform: scale(1.1);
      }
      .microchip-company-item input[type="text"] {
        flex: 1;
        padding: 6px 10px;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        font-size: 14px;
        margin-left: 8px;
      }
      .microchip-company-item input[type="text"]:focus {
        border-color: #4caf50;
        box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.1);
      }
      .tattoo-link {
        margin: 8px 0 0 0;
        padding: 8px;
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 6px;
      }
      .tattoo-link a {
        color: #856404;
        text-decoration: none;
        font-size: 0.9em;
        font-weight: 500;
      }
      .tattoo-link a:hover {
        color: #533d03;
        text-decoration: underline;
      }
      .tattoo-details {
        display: none;
        margin-top: 10px;
        padding: 12px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e9ecef;
      }
      .tattoo-details.show {
        display: block;
      }
      .tattoo-details-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
      }
      .tattoo-detail-item {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }
      .tattoo-detail-item label {
        font-size: 0.85em;
        font-weight: 600;
        color: #495057;
      }
      .tattoo-detail-item input {
        padding: 8px 10px;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        font-size: 14px;
      }
      .tattoo-detail-item input:focus {
        border-color: #4caf50;
        box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.1);
      }
      .output strong {
        font-weight: bold;
        color: #495057;
      }
      .output .purple-bold {
        font-weight: bold;
        color: #6f42c1;
      }

      /* ------------------ Dark mode overrides ------------------ */
      body.dark {
        color: #e5e7eb;
        background: linear-gradient(135deg, #0f172a 0%, #111827 100%);
      }
      body.dark .container {
        background: #0b1220;
      }
      body.dark .header {
        background: linear-gradient(135deg, #1f2937, #0f172a);
      }
      body.dark .header p {
        opacity: 0.95;
      }
      body.dark .theme-toggle {
        background: rgba(255, 255, 255, 0.12);
        border-color: rgba(255, 255, 255, 0.25);
      }
      body.dark .form-section {
        background: #0d1117;
        border-right-color: #1f2937;
      }
      body.dark .output-section {
        background: #0b1220;
      }
      body.dark .form-group label {
        color: #e5e7eb;
      }
      body.dark .form-group input,
      body.dark .form-group select {
        background: #0b1220;
        color: #e5e7eb;
        border-color: #374151;
      }
      body.dark .form-group input::placeholder {
        color: #9ca3af;
      }
      body.dark .checkbox-item {
        background: #0b1220;
        border-color: #374151;
      }
      body.dark .cat-section {
        background: #0b1220;
        border-color: #374151;
      }
      body.dark .same-as-checkbox {
        background: #0b1220;
        border: 1px dashed #374151;
      }
      body.dark .microchip-companies {
        background: #0b1220;
        border-color: #374151;
      }
      body.dark .microchip-company-item {
        background: #0b1220;
        border-color: #374151;
      }
      body.dark .tattoo-link {
        background: #1f2937;
        border-color: #374151;
      }
      body.dark .tattoo-link a {
        color: #fbbf24;
      }
      body.dark .output {
        border-color: #374151;
        color: #e5e7eb;
      }
      body.dark .copy-btn {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      }
      body.dark .reset-btn {
        background: linear-gradient(135deg, #4b5563, #374151);
      }
      body.dark .add-cat-btn {
        background: linear-gradient(135deg, #0ea5e9, #0284c7);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>🐱 VOKRA Adoption Follow-up</h1>
        <p>Generate personalized adoption follow-up emails</p>
        <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()">
          🌙 Dark Mode
        </button>
      </div>

      <div class="main-content">
        <div class="form-section">
          <div class="form-group">
            <label for="adopterName">Adopter First Name:</label>
            <input
              type="text"
              id="adopterName"
              placeholder="Enter adopter's first name" />
          </div>

          <button class="add-cat-btn" onclick="addCat()">
            ➕ Add Another Cat
          </button>
          <div id="catsContainer"></div>

          <div class="form-group">
            <label for="pacuDate">PACU Due Date:</label>
            <input type="date" id="pacuDate" />
          </div>

          <h2 class="section-title">Email Content Options</h2>
          <div class="form-group">
            <label>Include Sections:</label>
            <div class="checkbox-group">
              <div class="checkbox-item">
                <input type="checkbox" id="healthSection" checked />
                <span>Health Reminders</span>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="identificationSection" checked />
                <span>Identification Info</span>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="insuranceSection" checked />
                <span>Insurance Info</span>
              </div>
              <div class="checkbox-item">
                <input type="checkbox" id="facebookSection" checked />
                <span>Facebook Group</span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="vaccineDate">Next Vaccine Due (for kittens):</label>
            <input type="date" id="vaccineDate" />
          </div>

          <div class="toolbar">
            <button class="generate-btn" onclick="generateEmail()">
              ✨ Generate Email
            </button>
            <button class="reset-btn" onclick="resetForm()">↺ Reset</button>
          </div>
        </div>

        <div class="output-section">
          <h2 class="section-title">Generated Email</h2>
          <div class="output" id="output">
            Click "Generate Email" to create your personalized adoption
            follow-up email...
          </div>
          <button class="copy-btn" onclick="copyToClipboard()">
            📋 Copy to Clipboard
          </button>
          <div class="copy-success" id="copySuccess">
            Email copied to clipboard! ✅
          </div>
        </div>
      </div>
    </div>

    <script>
      let catCount = 0;

      /* ---------- Utils ---------- */
      function startOfDay(d) {
        const x = new Date(d);
        x.setHours(0, 0, 0, 0);
        return x;
      }
      function todayStart() {
        const t = new Date();
        t.setHours(0, 0, 0, 0);
        return t;
      }
      function isTodayStr(dateStr) {
        if (!dateStr) return false;
        const d = startOfDay(dateStr + "T00:00:00");
        const t = todayStart();
        return d.getTime() === t.getTime();
      }
      function compareToToday(dateStr) {
        if (!dateStr) return null;
        const d = startOfDay(dateStr + "T00:00:00").getTime();
        const t = todayStart().getTime();
        return d < t ? -1 : d > t ? 1 : 0;
      }
      function addMonths(dateObj, n) {
        const d = new Date(dateObj);
        const day = d.getDate();
        d.setMonth(d.getMonth() + n);
        if (d.getDate() !== day) {
          d.setDate(0);
        }
        return d;
      }
      function monthsBetween(dob, ref) {
        let months =
          (ref.getFullYear() - dob.getFullYear()) * 12 +
          (ref.getMonth() - dob.getMonth());
        if (ref.getDate() < dob.getDate()) months--;
        return Math.max(0, months);
      }
      function formatDate(dateString) {
        if (!dateString) return "[Date]";
        const date = new Date(dateString + "T00:00:00");
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        const day = date.getDate();
        const month = months[date.getMonth()];
        const suffix =
          day === 1 || day === 21 || day === 31
            ? "st"
            : day === 2 || day === 22
            ? "nd"
            : day === 3 || day === 23
            ? "rd"
            : "th";
        return `${month} ${day}${suffix}`;
      }
      function withTodayTag(dateStr) {
        if (!dateStr) return "[Date]";
        return isTodayStr(dateStr)
          ? `${formatDate(dateStr)} (Today)`
          : formatDate(dateStr);
      }

      /* ---------- Cat card UI ---------- */
      function createCatSection(index) {
        const isFirst = index === 0;
        const el = document.createElement("div");
        el.className = "cat-section";
        el.id = `cat-${index}`;
        el.innerHTML = `
          <h3>${isFirst ? "Cat 1" : `Cat ${index + 1}`}${
          !isFirst
            ? `<button class="remove-cat-btn" onclick="removeCat(${index})">Remove</button>`
            : ""
        }</h3>

          <div class="form-group">
            <label for="catName-${index}">Cat Name:</label>
            <input type="text" id="catName-${index}" placeholder="Enter cat's name" onchange="updateSameAsLabels(); generateEmail();">
          </div>

          <div class="form-group">
            <label for="catGender-${index}">Cat Gender:</label>
            <select id="catGender-${index}" onchange="generateEmail();">
              <option value="">Select gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </div>

          <div class="form-group">
            <label for="catDob-${index}">Date of Birth (DOB):</label>
            <input type="date" id="catDob-${index}" onchange="updateFromDOB(${index}); generateEmail();">
            ${
              !isFirst
                ? `
            <div class="same-as-checkbox">
              <input type="checkbox" id="sameDob-${index}" onchange="copyCatDOB(${index});">
              <label for="sameDob-${index}" id="sameDobLabel-${index}">Same DOB as first cat</label>
            </div>`
                : ""
            }
            <small style="color:#6c757d;font-size:0.85em;display:block;margin-top:8px;">
              Age & spay/neuter timing are auto-calculated from DOB.
            </small>
          </div>

          <div class="form-group">
            <label for="spayNeuterDate-${index}">Spay/Neuter Due Date (auto):</label>
            <input type="date" id="spayNeuterDate-${index}" readonly style="background-color:#f8f9fa;color:#495057;">
            <small style="color:#6c757d;font-size:0.85em;display:block;">Auto: DOB + 5 months</small>
          </div>

          <div class="form-group">
            <label>Identification:</label>
            <div class="checkbox-item">
              <input type="checkbox" id="hasTattoo-${index}" onchange="toggleTattooDetails(${index}); generateEmail();">
              <span>Has tattoo/ear tag</span>
            </div>
            <div id="tattooDetails-${index}" class="tattoo-details">
              <div class="tattoo-details-grid">
                <div class="tattoo-detail-item">
                  <label for="hospitalName-${index}">Animal Hospital Name:</label>
                  <input type="text" id="hospitalName-${index}" placeholder="Enter hospital name" onchange="generateEmail();">
                </div>
                <div class="tattoo-detail-item">
                  <label for="hospitalPhone-${index}">Phone Number:</label>
                  <input type="text" id="hospitalPhone-${index}" placeholder="604-XXX-XXXX" onchange="generateEmail();" oninput="formatPhoneNumber(this);" onpaste="setTimeout(()=>formatPhoneNumber(this),10);">
                </div>
              </div>
              <div class="tattoo-link" style="margin-top: 10px;">
                <a href="https://drive.google.com/file/d/1JNpRKjl_b5VlKgGa9dyeKouTGp-e7RIz/view?usp=sharing" target="_blank" rel="noopener">🔍 Please check tattoo number on <strong style="text-decoration:underline;">BCPet Registry Tattoo Code 2024</strong></a>
              </div>
            </div>

            <div class="checkbox-item" style="margin-top:10px;">
              <input type="checkbox" id="hasMicrochip-${index}" onchange="toggleMicrochipInput(${index}); generateEmail();">
              <span>Has microchip</span>
            </div>

            <div id="microchipInputContainer-${index}" style="display:none;margin-top:10px;">
              <div style="display:flex;gap:10px;align-items:center;">
                <input type="text" id="microchipNumber-${index}" placeholder="Enter microchip number" style="flex:1;padding:8px 12px;border:2px solid #e9ecef;border-radius:6px;font-size:14px;" onchange="generateEmail(); toggleSearchButton(${index});" oninput="toggleSearchButton(${index});">
                <button id="searchButton-${index}" class="search-microchip-btn" onclick="searchMicrochip(${index})" disabled>🔍 Search on AAHA</button>
              </div>

              <div id="microchipCompanies-${index}" class="microchip-companies show">
                <label>Microchip Company:</label>
                <div class="microchip-company-options">
                  <div class="microchip-company-item">
                    <input type="radio" id="smartTag-${index}" name="microchipCompany-${index}" value="smartTag" onchange="generateEmail();">
                    <span>SmartTag</span>
                  </div>
                  <div class="microchip-company-item">
                    <input type="radio" id="bcPetRegistry-${index}" name="microchipCompany-${index}" value="bcPetRegistry" onchange="generateEmail();">
                    <span>BC Pet Registry</span>
                  </div>
                  <div class="microchip-company-item">
                    <input type="radio" id="otherCompany-${index}" name="microchipCompany-${index}" value="other" onchange="toggleOtherCompanyInput(${index}); generateEmail();">
                    <span>Other:</span>
                    <input type="text" id="otherCompanyName-${index}" placeholder="Enter company name" style="display:none;" onchange="generateEmail();">
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        return el;
      }

      function addCat() {
        const container = document.getElementById("catsContainer");
        const card = createCatSection(catCount);
        container.appendChild(card);
        toggleTattooDetails(catCount);
        catCount++;
        updateSameAsLabels();
      }

      function removeCat(index) {
        const card = document.getElementById(`cat-${index}`);
        if (card) {
          card.remove();
          generateEmail();
        }
      }

      function updateSameAsLabels() {
        const firstName =
          document.getElementById("catName-0")?.value || "first cat";
        for (let i = 1; i < catCount; i++) {
          const label = document.getElementById(`sameDobLabel-${i}`);
          if (label) {
            label.textContent = `Same DOB as ${firstName}`;
          }
        }
      }

      function copyCatDOB(toIndex) {
        const cb = document.getElementById(`sameDob-${toIndex}`);
        if (cb?.checked) {
          const firstDob = document.getElementById("catDob-0")?.value || "";
          document.getElementById(`catDob-${toIndex}`).value = firstDob;
          updateFromDOB(toIndex);
          generateEmail();
        }
      }

      function updateFromDOB(catIndex) {
        const dobStr = document.getElementById(`catDob-${catIndex}`)?.value;
        const out = document.getElementById(`spayNeuterDate-${catIndex}`);
        if (!dobStr) {
          if (out) out.value = "";
          return;
        }
        const dob = new Date(dobStr + "T00:00:00");
        const spayDate = addMonths(dob, 5);
        if (out) {
          out.value = spayDate.toISOString().split("T")[0];
        }
      }

      function toggleTattooDetails(catIndex) {
        const checkbox = document.getElementById(`hasTattoo-${catIndex}`);
        const detailsDiv = document.getElementById(`tattooDetails-${catIndex}`);
        if (!checkbox || !detailsDiv) return;
        if (checkbox.checked) {
          detailsDiv.classList.add("show");
          const input = document.getElementById(`hospitalName-${catIndex}`);
          if (input) {
            setTimeout(() => input.focus(), 100);
          }
        } else {
          detailsDiv.classList.remove("show");
          document.getElementById(`hospitalName-${catIndex}`).value = "";
          document.getElementById(`hospitalPhone-${catIndex}`).value = "";
        }
      }

      function toggleMicrochipInput(catIndex) {
        const checkbox = document.getElementById(`hasMicrochip-${catIndex}`);
        const box = document.getElementById(
          `microchipInputContainer-${catIndex}`
        );
        const input = document.getElementById(`microchipNumber-${catIndex}`);
        const btn = document.getElementById(`searchButton-${catIndex}`);
        if (checkbox.checked) {
          box.style.display = "block";
          input.focus();
          toggleSearchButton(catIndex);
        } else {
          box.style.display = "none";
          input.value = "";
          if (btn) {
            btn.disabled = true;
          }
          const radios = document.getElementsByName(
            `microchipCompany-${catIndex}`
          );
          radios.forEach((r) => (r.checked = false));
          document.getElementById(`otherCompanyName-${catIndex}`).value = "";
          document.getElementById(
            `otherCompanyName-${catIndex}`
          ).style.display = "none";
        }
      }

      function toggleOtherCompanyInput(catIndex) {
        const r = document.getElementById(`otherCompany-${catIndex}`);
        const input = document.getElementById(`otherCompanyName-${catIndex}`);
        if (r.checked) {
          input.style.display = "block";
          input.focus();
        } else {
          input.style.display = "none";
          input.value = "";
        }
      }

      function toggleSearchButton(catIndex) {
        const input = document.getElementById(`microchipNumber-${catIndex}`);
        const btn = document.getElementById(`searchButton-${catIndex}`);
        if (input && btn) {
          btn.disabled = !(input.value.trim().length > 0);
        }
      }

      function searchMicrochip(catIndex) {
        const n = document
          .getElementById(`microchipNumber-${catIndex}`)
          .value.trim();
        if (n) {
          const now = new Date();
          const months = [
            "Jan",
            "Feb",
            "Mar",
            "Apr",
            "May",
            "Jun",
            "Jul",
            "Aug",
            "Sep",
            "Oct",
            "Nov",
            "Dec",
          ];
          const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
          const dateString = `${months[now.getMonth()]}%20${
            days[now.getDay()]
          },%20${now.getFullYear()}`;
          const url = `https://www.aaha.org/for-veterinary-professionals/microchip-search/?microchip_id=${encodeURIComponent(
            n
          )}&date=${dateString}`;
          window.open(url, "_blank");
        }
      }

      function getAllCats() {
        const cats = [];
        for (let i = 0; i < catCount; i++) {
          const section = document.getElementById(`cat-${i}`);
          if (!section) continue;
          const name =
            document.getElementById(`catName-${i}`)?.value ||
            `[Cat ${i + 1} Name]`;
          const gender = document.getElementById(`catGender-${i}`)?.value;
          const dobStr = document.getElementById(`catDob-${i}`)?.value || "";
          const spayNeuterDate =
            document.getElementById(`spayNeuterDate-${i}`)?.value || "";
          const hasTattoo =
            document.getElementById(`hasTattoo-${i}`)?.checked || false;
          const hospitalName =
            document.getElementById(`hospitalName-${i}`)?.value || "";
          const hospitalPhone =
            document.getElementById(`hospitalPhone-${i}`)?.value || "";
          const hasMicrochip =
            document.getElementById(`hasMicrochip-${i}`)?.checked || false;
          const microchipNumber =
            document.getElementById(`microchipNumber-${i}`)?.value || "";
          const selectedCompany = document.querySelector(
            `input[name="microchipCompany-${i}"]:checked`
          );
          const smartTag = selectedCompany?.value === "smartTag";
          const bcPetRegistry = selectedCompany?.value === "bcPetRegistry";
          const otherCompany = selectedCompany?.value === "other";
          const otherCompanyName =
            document.getElementById(`otherCompanyName-${i}`)?.value || "";

          let ageInMonths = 0,
            category = "adult";
          if (dobStr) {
            const dob = new Date(dobStr + "T00:00:00");
            ageInMonths = monthsBetween(dob, todayStart());
            if (ageInMonths <= 5) category = "young-kitten";
            else if (ageInMonths > 5 && ageInMonths < 12)
              category = "old-kitten";
            else category = "adult";
          }

          cats.push({
            name,
            gender,
            dobStr,
            ageInMonths,
            category,
            spayNeuterDate,
            hasTattoo,
            hospitalName,
            hospitalPhone,
            hasMicrochip,
            microchipNumber,
            microchipCompany: {
              smartTag,
              bcPetRegistry,
              otherCompany,
              otherCompanyName,
            },
            pronoun:
              gender === "female" ? "her" : gender === "male" ? "his" : "their",
            pronounCap:
              gender === "female" ? "Her" : gender === "male" ? "His" : "Their",
            catPronoun:
              gender === "female" ? "she" : gender === "male" ? "he" : "they",
          });
        }
        return cats;
      }

      /* ---------- Pronouns for missing sentence ---------- */
      function getGroupPronounSet(cats) {
        if (!cats || cats.length === 0) {
          return { subj: "they", poss: "their", goVerb: "go" };
        }
        if (cats.length === 1) {
          const c = cats[0];
          if (c.gender === "male")
            return { subj: "he", poss: "his", goVerb: "goes" };
          if (c.gender === "female")
            return { subj: "she", poss: "her", goVerb: "goes" };
          return { subj: "they", poss: "their", goVerb: "go" };
        }
        return { subj: "they", poss: "their", goVerb: "go" };
      }
      function generateMissingReturnSentence(cats) {
        const p = getGroupPronounSet(cats);
        return `In the unlikely event ${p.subj} ${p.goVerb} missing, ${p.subj} can be returned to you as soon as possible via ${p.poss} tattoo and/or microchip.`;
      }

      /* ---------- Phone formatting ---------- */
      function formatPhoneNumber(input) {
        let digits = input.value.replace(/\D/g, "");
        if (digits.length === 11 && digits.startsWith("1"))
          digits = digits.substring(1);
        if (digits.length === 10) {
          input.value = `(${digits.substring(0, 3)}) ${digits.substring(
            3,
            6
          )}-${digits.substring(6)}`;
        } else if (digits.length === 7) {
          input.value = `${digits.substring(0, 3)}-${digits.substring(3)}`;
        }
        if (document.activeElement === input) {
          generateEmail();
        }
      }

      /* ---------- Email generation ---------- */
      function generateEmail() {
        const adopterName =
          document.getElementById("adopterName").value || "[Adopter Name]";
        const cats = getAllCats();
        if (cats.length === 0) return;

        const pacuDate = document.getElementById("pacuDate").value;
        const vaccineDate = document.getElementById("vaccineDate").value;

        const includeHealth = document.getElementById("healthSection").checked;
        const includeIdentification = document.getElementById(
          "identificationSection"
        ).checked;
        const includeInsurance =
          document.getElementById("insuranceSection").checked;
        const includeFacebook =
          document.getElementById("facebookSection").checked;

        const catNames = cats.map((c) => c.name).join(" and ");
        const hasKittens = cats.some((c) => c.category !== "adult");

        let email = `<p style="margin:0 0 16px 0;">Hi ${adopterName},</p>
<p style="margin:0 0 16px 0;">It's been a couple of weeks since you brought your new arrival home, and I hope everything is going well with ${catNames}! I am reaching out with a couple of reminders and to see if you have any questions since the adoption.</p>`;

        if (includeHealth) {
          email += `<p><strong>Health Related</strong></p>`;

          /* PACU block — add (Today) and avoid future tense if date is today */
          if (pacuDate) {
            const cmp = compareToToday(pacuDate);
            const catSubject =
              cats.length > 1 ? `${catNames}'` : `${cats[0].name}'s`;
            if (cmp > 0) {
              email += `<p>Please make sure you have booked ${catSubject} Post Adoption Checkup (PACU) with one of our partner vets, for a date on or before <strong class="purple-bold">${formatDate(
                pacuDate
              )}</strong>.</p>
<p>You will be asked to provide the Contract (Agreement) and Medical History for the PACU (sent during the contract meeting from ShelterLuv). Ask the vet if they would prefer these electronically or (hard copy) in person. To avoid any cost to you, it is critical to provide these 2 documents to the vet, at the PACU.</p>`;
            } else if (cmp === 0) {
              email += `<p>Please make sure you have booked ${catSubject} Post Adoption Checkup (PACU) with one of our partner vets, for <strong class="purple-bold">${withTodayTag(
                pacuDate
              )}</strong>.</p>
<p>Please bring the Contract (Agreement) and Medical History for the PACU (sent during the contract meeting from ShelterLuv). Ask the vet whether they prefer these electronically or (hard copy) in person. To avoid any cost to you, it is critical to provide these 2 documents to the vet at the PACU.</p>`;
            } else {
              email += `<p>I hope you were able to attend the Post Adoption Checkup (PACU) on <strong class="purple-bold">${formatDate(
                pacuDate
              )}</strong> with one of our partner vets and that all is well.</p>`;
            }
          }

          /* Vaccine block — add (Today) and change "will be" to "is" when today */
          if (hasKittens && vaccineDate) {
            const vcmp = compareToToday(vaccineDate);
            const kittens = cats.filter((c) => c.category !== "adult");
            const possessiveText = kittens.length > 1 ? "kittens'" : "kitten's";

            if (vcmp > 0) {
              email += `<p>Kitten vaccine protocol: kittens require 2 FVRCP vaccines, spaced one month apart. Your ${possessiveText} next vaccine is due: <strong class="purple-bold">${formatDate(
                vaccineDate
              )}</strong>. This will be at your cost.</p>`;
            } else if (vcmp === 0) {
              email += `<p>Kitten vaccine protocol: kittens require 2 FVRCP vaccines, spaced one month apart. Your ${possessiveText} next vaccine is due: <strong class="purple-bold">${withTodayTag(
                vaccineDate
              )}</strong>. This is at your cost.</p>`;
            } else {
              email += `<p>Kitten vaccine protocol: kittens require 2 FVRCP vaccines, spaced one month apart. Your ${possessiveText} second vaccine was due: <strong class="purple-bold">${formatDate(
                vaccineDate
              )}</strong>, at your cost.</p>`;
            }
          }

          /* Kittens spay/neuter policy text (DOB-based) */
          if (hasKittens) {
            const kittens = cats.filter((c) => c.category !== "adult");
            if (kittens.length > 0) {
              let surgeryText = "";
              if (kittens.length === 1) {
                const k = kittens[0];
                const procedure =
                  k.gender === "female"
                    ? "spay"
                    : k.gender === "male"
                    ? "neuter"
                    : "spay/neuter";
                surgeryText = `Your kitten will need ${k.pronoun} ${procedure}, tattoo (if applicable) and microchip insertion completed at the same partner vet that you attended for ${k.pronoun} PACU; cost is covered by adoption fees. `;
              } else {
                surgeryText = `Your kittens will need their spay/neuter, tattoos (if applicable) and microchip insertion completed at the same partner vet that you attended for their PACU; cost is covered by adoption fees. `;
              }

              if (cats.length === 2) {
                const genders = cats.map((c) => c.gender);
                if (genders.includes("male") && genders.includes("female")) {
                  surgeryText += `VOKRA policy states with a male-female pair, this should be done at <strong class="purple-bold">4 - 4.5 months of age</strong>; `;
                } else if (genders[0] === genders[1]) {
                  surgeryText += `VOKRA policy states with a same gender pair, this should be done at 5 months of age; `;
                }
              }

              const hasFemaleCats = kittens.some((c) => c.gender === "female");
              surgeryText += hasFemaleCats
                ? `This avoids unwanted pregnancies, and prevents other mating behaviours from occurring.`
                : `This avoids other mating behaviours from occurring.`;
              email += `<p>${surgeryText}</p>`;

              if (cats.length === 2 && kittens.length === 2) {
                const genders = cats.map((c) => c.gender);
                const hasSpayDate = kittens.some((c) => c.spayNeuterDate);
                if (hasSpayDate) {
                  if (genders.includes("male") && genders.includes("female")) {
                    const firstDate = new Date(kittens[0].spayNeuterDate);
                    firstDate.setMonth(firstDate.getMonth() - 1);
                    const secondDate = new Date(firstDate);
                    secondDate.setDate(secondDate.getDate() + 14);
                    email += `<p>Your kittens will be <strong class="purple-bold">4 - 4.5 months of age: ${formatDate(
                      firstDate.toISOString().split("T")[0]
                    )} to ${formatDate(
                      secondDate.toISOString().split("T")[0]
                    )}</strong>. Please note some partner vets may push back on the 4 mos of age. They know our policy, and as long as the kittens are of sufficient weight to undergo the anesthetic, they can go ahead with the surgery.</p>`;
                  } else if (genders[0] === genders[1]) {
                    email += `<p>Your kittens will be 5 months of age on: <strong class="purple-bold">${formatDate(
                      kittens[0].spayNeuterDate
                    )}</strong>. Please note some partner vets may push back on the 4 mos of age. They know our policy, and as long as the kittens are of sufficient weight to undergo the anesthetic, they can go ahead with the surgery.</p>`;
                  }
                }
              } else {
                let ageText = "";
                if (kittens.length === 1) {
                  const k = kittens[0];
                  if (k.spayNeuterDate) {
                    ageText = `Your kitten will be 5 months of age on: <strong class="purple-bold">${formatDate(
                      k.spayNeuterDate
                    )}</strong>.`;
                  }
                } else {
                  const arr = [];
                  kittens.forEach((c) => {
                    if (c.spayNeuterDate) {
                      arr.push(
                        `${
                          c.name
                        } will be 5 months of age on: <strong class="purple-bold">${formatDate(
                          c.spayNeuterDate
                        )}</strong>`
                      );
                    }
                  });
                  if (arr.length > 0) {
                    ageText = arr.join("<br>");
                  }
                }
                if (ageText) {
                  ageText +=
                    " Please note some partner vets may push back on the 4 mos of age. They know our policy, and as long as the kittens are of sufficient weight to undergo the anesthetic, they can go ahead with the surgery.";
                  email += `<p>${ageText}</p>`;
                }
              }
            }
          }

          /* Continuation sentence */
          email += `<p>${generateVetContinuationSentence(cats)}</p>`;
        }

        if (includeIdentification) {
          email += `<p><strong>Identification</strong></p>`;

          const hasTattooedCats = cats.some((c) => c.hasTattoo);
          const hasMicrochippedCats = cats.some((c) => c.hasMicrochip);

          if (hasTattooedCats) {
            const tattooedCat = cats.find(
              (c) => c.hasTattoo && (c.hospitalName || c.hospitalPhone)
            );
            if (tattooedCat && tattooedCat.hospitalName) {
              const phoneText = tattooedCat.hospitalPhone
                ? ` at <strong class="purple-bold">${tattooedCat.hospitalPhone}</strong>`
                : "";
              email += `<p>If you haven't already done so, please contact <strong class="purple-bold">${tattooedCat.hospitalName}</strong>${phoneText} where the tattoo was completed to change ownership of your kitty.</p>`;
            } else {
              email += `<p>If you haven't already done so, please contact *** Animal Hospital at 604(phone number). *** where the tattoo was completed to change ownership of your kitty.</p>`;
            }
          }

          const missingSentence = generateMissingReturnSentence(cats);

          if (hasMicrochippedCats) {
            const hasSmartTagCats = cats.some(
              (c) => c.hasMicrochip && c.microchipCompany.smartTag
            );
            const hasBCPetOrOther = cats.some(
              (c) =>
                c.hasMicrochip &&
                (c.microchipCompany.bcPetRegistry ||
                  c.microchipCompany.otherCompany)
            );

            if (hasSmartTagCats && !hasBCPetOrOther) {
              const kittyText =
                cats.length === 1 ? "your kitty's" : `${catNames}'s`;
              email += `<p>Our microchip provider SmartTag, will send you an email <strong class="purple-bold">within 6 weeks of their surgery</strong> to ask you to set up an account. There is no cost for this, but it will be your method to keep your contact info up to date (see microchip program page sent during the contract meeting).</p>`;
              email += `<p>Please ensure ${kittyText} identification registration is always kept current. ${missingSentence}</p>`;
              email += `<p>If your contact information should change in the future please contact:<br>- The vet who completed the spay/neuter and who has the tattoo database;<br>- The microchip provider (refer to your cat's Medical History document)</p>`;
            } else if (hasBCPetOrOther) {
              const bcCats = cats.filter(
                (c) => c.hasMicrochip && c.microchipCompany.bcPetRegistry
              );
              const otherCats = cats.filter(
                (c) => c.hasMicrochip && c.microchipCompany.otherCompany
              );

              if (bcCats.length > 0) {
                let pronoun;
                if (bcCats.length === 1) {
                  const cat = bcCats[0];
                  pronoun =
                    cat.gender === "female"
                      ? "her"
                      : cat.gender === "male"
                      ? "his"
                      : "the";
                } else pronoun = "their";
                email += `<p>The microchip provider BC Pet Registry has been advised of ${pronoun} change of ownership. If you need to contact them, please visit: https://www.bcpetregistry.ca<br>or call: 855-622-7722 (Business Hours), 866-303-5950 (After Hours).</p>`;
              }
              if (otherCats.length > 0) {
                otherCats.forEach((cat) => {
                  if (cat.microchipCompany.otherCompanyName) {
                    email += `<p>The microchip provider ${cat.microchipCompany.otherCompanyName} has been advised of ${cat.pronoun} change of ownership.</p>`;
                  }
                });
              }

              const kittyText =
                cats.length === 1 ? "your kitty's" : `${catNames}'s`;
              email += `<p>Please ensure ${kittyText} identification registration is always kept current. ${missingSentence}</p>`;

              if (bcCats.length > 0) {
                email += `<p>If your contact information should change in the future please contact:<br>- BC Pet Registry, who completed the spay and who has the tattoo database as well as the microchip information.</p>`;
              } else {
                email += `<p>If your contact information should change in the future please contact:<br>- The vet who completed the spay/neuter and who has the tattoo database;<br>- The microchip provider (refer to your cat's Medical History document)</p>`;
              }
            } else {
              const kittyText =
                cats.length === 1 ? "your kitty's" : `${catNames}'s`;
              email += `<p>Please ensure ${kittyText} identification registration is always kept current. ${missingSentence}</p>`;
              email += `<p>If your contact information should change in the future please contact:<br>- The vet who completed the spay/neuter and who has the tattoo database;<br>- The microchip provider (refer to your cat's Medical History document)</p>`;
            }
          } else {
            email += `<p>Our microchip provider SmartTag, will send you an email <strong class="purple-bold">within 6 weeks of their surgery</strong> to ask you to set up an account. There is no cost for this, but it will be your method to keep your contact info up to date (see microchip program page sent during the contract meeting).</p>`;
            email += `<p>Please ensure ${catNames}'s identification registration is always kept current. ${missingSentence}</p>`;
            email += `<p>If your contact information should change in the future please contact:<br>- The vet who completed the spay/neuter and who has the tattoo database;<br>- The microchip provider (refer to your cat's Medical History document)</p>`;
          }
        }

        if (includeInsurance) {
          email += `<p><strong>Insurance</strong></p>
<p>${catNames} may qualify for a free trial pet insurance with PetSecure. If you had previously indicated an interest in insurance, please read the information sent to you. If you are now interested, please let me know and I can send you the information. If you wish to enrol, please complete the form and bring it with you to our partner vet during the PACU. The vet will activate the insurance on your behalf.</p>`;
        }

        email += `<p>Feel free to reach out directly to adoptersupport@vokra.ca for any cat behaviour or other non-emergency questions.</p>`;

        if (includeFacebook) {
          email += `<p>Join VOKRA Alumni on Facebook (<a href="https://www.facebook.com/groups/557083514316555" target="_blank" rel="noopener">VOKRA ALUMNI | Facebook</a>) and post photos of ${catNames}!</p>`;
        }

        email += `<p>Thank you for giving ${catNames} a loving and fur-ever home!</p>`;

        document.getElementById("output").innerHTML = email;
      }

      /* Keeps: adult vs kitten continuation sentence */
      function generateVetContinuationSentence(cats) {
        const kittens = cats.filter((c) => c.category !== "adult");
        const adults = cats.filter((c) => c.category === "adult");
        if (kittens.length === 0) {
          if (cats.length === 1) {
            return `You are welcome to, but there is no obligation for you to continue to attend this vet after ${cats[0].pronoun} PACU.`;
          } else {
            return `You are welcome to, but there is no obligation for you to continue to attend this vet after their PACU.`;
          }
        }
        if (adults.length === 0) {
          let surgeryText = "";
          if (kittens.length === 1) {
            const k = kittens[0];
            const procedure =
              k.gender === "female"
                ? "spay"
                : k.gender === "male"
                ? "neuter"
                : "spay/neuter";
            surgeryText = `${k.pronoun} PACU/${procedure} surgery`;
          } else {
            const hasF = kittens.some((c) => c.gender === "female");
            const hasM = kittens.some((c) => c.gender === "male");
            if (hasF && hasM) surgeryText = `their PACU/spay/neuter surgery`;
            else if (hasF && !hasM) surgeryText = `their PACU/spay surgery`;
            else if (!hasF && hasM) surgeryText = `their PACU/neuter surgery`;
            else surgeryText = `their PACU/spay/neuter surgery`;
          }
          return `You are welcome to, but there is no obligation for you to continue to attend this vet after ${surgeryText}.`;
        }
        let surgeryText = "";
        const hasF = kittens.some((c) => c.gender === "female");
        const hasM = kittens.some((c) => c.gender === "male");
        if (hasF && hasM) surgeryText = `their PACU/spay/neuter surgery`;
        else if (hasF && !hasM) surgeryText = `their PACU/spay surgery`;
        else if (!hasF && hasM) surgeryText = `their PACU/neuter surgery`;
        else surgeryText = `their PACU/spay/neuter surgery`;
        return `You are welcome to, but there is no obligation for you to continue to attend this vet after ${surgeryText}.`;
      }

      function copyToClipboard() {
        const output = document.getElementById("output");
        const range = document.createRange();
        const sel = window.getSelection();
        sel.removeAllRanges();
        range.selectNodeContents(output);
        sel.addRange(range);
        try {
          const ok = document.execCommand("copy");
          sel.removeAllRanges();
          const msg = document.getElementById("copySuccess");
          msg.textContent = ok
            ? "Formatted email copied to clipboard! ✅"
            : "Please manually select and copy the text above.";
          msg.classList.add("show");
          msg.style.color = ok ? "#28a745" : "#dc3545";
          setTimeout(() => {
            msg.classList.remove("show");
            if (!ok) msg.style.color = "#28a745";
          }, 3000);
        } catch (e) {
          sel.removeAllRanges();
          const msg = document.getElementById("copySuccess");
          msg.textContent = "Please manually select and copy the text above.";
          msg.style.color = "#dc3545";
          msg.classList.add("show");
          setTimeout(() => {
            msg.classList.remove("show");
            msg.style.color = "#28a745";
          }, 5000);
        }
      }

      /* ---------- Reset form ---------- */
      function resetForm() {
        // clear adopter & dates
        document.getElementById("adopterName").value = "";
        document.getElementById("pacuDate").value = "";
        document.getElementById("vaccineDate").value = "";

        // reset include checkboxes to defaults (all true)
        document.getElementById("healthSection").checked = true;
        document.getElementById("identificationSection").checked = true;
        document.getElementById("insuranceSection").checked = true;
        document.getElementById("facebookSection").checked = true;

        // reset cats
        const container = document.getElementById("catsContainer");
        container.innerHTML = "";
        catCount = 0;
        addCat(); // one fresh empty card (tattoo details hidden by default)

        // reset output
        document.getElementById("output").innerHTML =
          'Click "Generate Email" to create your personalized adoption follow-up email...';
        const success = document.getElementById("copySuccess");
        success.classList.remove("show");
        // scroll back to top for clarity
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      /* ---------- Theme toggle ---------- */
      function applyTheme(theme) {
        const body = document.body;
        const btn = document.getElementById("themeToggle");
        if (theme === "dark") {
          body.classList.add("dark");
          btn.textContent = "☀️ Light Mode";
        } else {
          body.classList.remove("dark");
          btn.textContent = "🌙 Dark Mode";
        }
      }
      function toggleTheme() {
        const isDark = document.body.classList.toggle("dark");
        const theme = isDark ? "dark" : "light";
        localStorage.setItem("vokra_theme", theme);
        applyTheme(theme);
      }

      document
        .getElementById("adopterName")
        .addEventListener("input", generateEmail);

      document.addEventListener("DOMContentLoaded", function () {
        // theme init
        const saved = localStorage.getItem("vokra_theme") || "light";
        applyTheme(saved);
        // form init
        addCat();
      });
    </script>
  </body>
</html>
